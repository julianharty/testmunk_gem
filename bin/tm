#!/usr/bin/env ruby

require 'optparse'

$stderr.sync = true

option = nil
file = nil

# parse arguments
ARGV.options do |opts|
  opts.on('-f', '--file=val', '.ipa file', String) { |val| file = val }
  opts.on('-o', '--opt=val', 'Options: resign (tm -o resign -f app.ipa)', String) { |val| option = val }
  opts.on('-h', '--help', 'Displays Help') do
    puts opts
    exit
  end

  opts.parse!
end


def resign(file)
  system "BRIAR_DONT_OPEN_ON_RESIGN=1 briar resign #{file} "\
              "#{ENV['TM_MOBILE_PROVISION']} "\
              "#{ENV['TM_WILDCARD']} "\
              "\"#{ENV['TM_IOS_CERTIFICATE']}\""
end

case option
  when 'resign'
    resign file if file
end